{% extends "base.html" %}
{% block title %}Employee Dashboard — LeaveMgmt{% endblock %}

{% block content %}

<style>
  /* ---- Modern Clean UI Styling ---- */

  .card {
    border-radius: 12px;
    border: 1px solid #e5e7eb;
    box-shadow: 0 3px 12px rgba(0,0,0,0.06);
  }

  .card-header {
    background: linear-gradient(90deg, #4f46e5, #6366f1);
    color: white;
    border-bottom: none;
    font-weight: 600;
  }

  .btn-primary,
  .btn-success {
    background: #4f46e5 !important;
    border: none !important;
    border-radius: 8px;
  }

  .btn-primary:hover,
  .btn-success:hover {
    background: #4338ca !important;
  }

  .badge.bg-primary {
    background: #4f46e5 !important;
  }

  .badge.bg-warning {
    background: #fbbf24 !important;
  }

  .badge.bg-success {
    background: #22c55e !important;
  }

  .badge.bg-danger {
    background: #ef4444 !important;
  }

  .table-hover tbody tr:hover {
    background: #f4f5ff;
  }

  /* Mobile spacing */
  @media (max-width: 576px) {
    h4 { font-size: 1.2rem; }
    .card-header { padding: 0.7rem 1rem; }
    .card-body { padding: 0.9rem; }
  }
</style>

<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">Employee Dashboard</h4>
    <small class="text-muted">Welcome, {{ user.username|title }} ({{ user.profile.get_role_display }})</small>
  </div>

  <div class="row g-4">

    <!-- ================= LEFT COLUMN ================= -->
    <div class="col-lg-4">

      <!-- Leave Balance Card -->
      <div class="card">
        <div class="card-header">
          Leave Balance
        </div>
        <div class="card-body">
          <p class="mb-1"><strong>Casual:</strong> {{ balance.casual }}</p>
          <p class="mb-1"><strong>Sick:</strong> {{ balance.sick }}</p>
          <p class="mb-1"><strong>Earned:</strong> {{ balance.earned }}</p>

          <div class="mt-3">
            <a class="btn btn-primary w-100" href="{% url 'apply_leave' %}">
              <i class="fa fa-calendar-plus me-1"></i> Apply for Leave
            </a>
          </div>
        </div>
      </div>

      <!-- ❌ QUICK ACTIONS REMOVED COMPLETELY -->

    </div>

    <!-- ================= RIGHT COLUMN ================= -->
    <div class="col-lg-8">

      <!-- Pending Requests -->
      <div class="card mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
          My Pending Requests
          <small class="text-light">{{ pending|length }} pending</small>
        </div>

        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>Dates</th>
                  <th>Type</th>
                  <th>Status</th>
                  <th class="text-end">Action</th>
                </tr>
              </thead>
              <tbody>
                {% for l in pending %}
                <tr>
                  <td>
                    {{ l.start_date|date:"d M, Y" }} → {{ l.end_date|date:"d M, Y" }}
                  </td>
                  <td>
                    <span class="badge bg-primary">{{ l.get_leave_type_display }}</span>
                  </td>
                  <td>
                    {% if l.status == 'PEN' %}
                      <span class="badge bg-warning text-dark">Pending</span>
                    {% elif l.status == 'APP' %}
                      <span class="badge bg-success">Approved</span>
                    {% elif l.status == 'REJ' %}
                      <span class="badge bg-danger">Rejected</span>
                    {% endif %}
                  </td>
                  <td class="text-end">
                    <a class="btn btn-sm btn-danger" href="{% url 'cancel_leave' l.pk %}">
                      Cancel
                    </a>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="4" class="text-center py-3 text-muted">No pending requests</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- All Leaves -->
      <div class="card">
        <div class="card-header">
          All My Leaves
        </div>

        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-sm mb-0">
              <thead class="table-light">
                <tr>
                  <th>Dates</th>
                  <th>Type</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                {% for l in my_leaves %}
                <tr>
                  <td>{{ l.start_date|date:"d M, Y" }} → {{ l.end_date|date:"d M, Y" }}</td>
                  <td>{{ l.get_leave_type_display }}</td>
                  <td>
                    {% if l.status == 'APP' %}
                      <span class="badge bg-success">Approved</span>
                    {% elif l.status == 'REJ' %}
                      <span class="badge bg-danger">Rejected</span>
                    {% elif l.status == 'CAN' %}
                      <span class="badge bg-secondary">Cancelled</span>
                    {% else %}
                      <span class="badge bg-warning text-dark">Pending</span>
                    {% endif %}
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="3" class="text-center py-3 text-muted">No leaves yet</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>

      </div>

    </div>
  </div>
</div>

{% endblock %}
