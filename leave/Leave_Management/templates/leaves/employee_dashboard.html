{% extends "base.html" %}
{% block title %}Employee Dashboard — LeaveMgmt{% endblock %}

{% block content %}
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">Employee Dashboard</h4>
    <small class="text-muted">Welcome, {{ user.username|title }} ({{ user.profile.get_role_display }})</small>
  </div>

  <div class="row g-4">
    <div class="col-lg-4">
      <div class="card">
        <div class="card-header">
          <strong>Leave Balance</strong>
        </div>
        <div class="card-body">
          <p class="mb-1"><strong>Casual:</strong> {{ balance.casual }}</p>
          <p class="mb-1"><strong>Sick:</strong> {{ balance.sick }}</p>
          <p class="mb-1"><strong>Earned:</strong> {{ balance.earned }}</p>

          <div class="mt-3">
            <a class="btn btn-success w-100" href="{% url 'apply_leave' %}">
              <i class="fa fa-calendar-plus me-1"></i> Apply for Leave
            </a>
          </div>
        </div>
      </div>

      <div class="card mt-3">
        <div class="card-header">
          <strong>Quick Actions</strong>
        </div>
        <div class="card-body">
          <a href="{% url 'register' %}" class="btn btn-outline-secondary w-100 mb-2">
            <i class="fa fa-user-plus me-1"></i> Create another account
          </a>
          <a href="{% url 'logout' %}" class="btn btn-outline-danger w-100" onclick="event.preventDefault(); document.getElementById('logoutForm').submit();">
            <i class="fa fa-sign-out-alt me-1"></i> Logout
          </a>
          <form id="logoutForm" method="post" action="{% url 'logout' %}" style="display:none;">
            {% csrf_token %}
          </form>
        </div>
      </div>
    </div>

    <div class="col-lg-8">
      <div class="card mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
          <strong>My Pending Requests</strong>
          <small class="text-muted">{{ pending|length }} pending</small>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>Dates</th>
                  <th>Type</th>
                  <th>Status</th>
                  <th class="text-end">Action</th>
                </tr>
              </thead>
              <tbody>
                {% for l in pending %}
                  <tr>
                    <td>
                      {{ l.start_date|date:"d M, Y" }} &rarr; {{ l.end_date|date:"d M, Y" }}
                    </td>
                    <td><span class="badge bg-primary">{{ l.get_leave_type_display }}</span></td>
                    <td>
                      {% if l.status == 'PEN' %}
                        <span class="badge bg-warning text-dark">Pending</span>
                      {% elif l.status == 'APP' %}
                        <span class="badge bg-success">Approved</span>
                      {% elif l.status == 'REJ' %}
                        <span class="badge bg-danger">Rejected</span>
                      {% else %}
                        <span class="badge bg-secondary">Cancelled</span>
                      {% endif %}
                    </td>
                    <td class="text-end">
                      <a class="btn btn-sm btn-outline-danger" href="{% url 'cancel_leave' l.pk %}">Cancel</a>
                    </td>
                  </tr>
                {% empty %}
                  <tr>
                    <td colspan="4" class="text-center py-3 text-muted">No pending requests</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <strong>All My Leaves</strong>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-sm mb-0">
              <thead class="table-light">
                <tr>
                  <th>Dates</th>
                  <th>Type</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                {% for l in my_leaves %}
                  <tr>
                    <td>{{ l.start_date|date:"d M, Y" }} → {{ l.end_date|date:"d M, Y" }}</td>
                    <td>{{ l.get_leave_type_display }}</td>
                    <td>
                      {% if l.status == 'APP' %}
                        <span class="badge bg-success">Approved</span>
                      {% elif l.status == 'REJ' %}
                        <span class="badge bg-danger">Rejected</span>
                      {% elif l.status == 'CAN' %}
                        <span class="badge bg-secondary">Cancelled</span>
                      {% else %}
                        <span class="badge bg-warning text-dark">Pending</span>
                      {% endif %}
                    </td>
                  </tr>
                {% empty %}
                  <tr>
                    <td colspan="3" class="text-center py-3 text-muted">No leaves yet</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
